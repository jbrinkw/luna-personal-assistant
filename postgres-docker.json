{
  "name": "postgres",
  "display_name": "PostgreSQL (Docker)",
  "description": "PostgreSQL database running in Docker with persistent data storage",
  "category": "database",
  "author": "Luna Team",
  "version": "1.0.0",
  
  "config_form": {
    "fields": [
      {
        "name": "port",
        "label": "Port",
        "type": "number",
        "default": 5432,
        "required": true,
        "help": "Port to expose PostgreSQL on"
      },
      {
        "name": "database",
        "label": "Database Name",
        "type": "text",
        "default": "luna_db",
        "required": true,
        "help": "Name of the default database to create"
      },
      {
        "name": "user",
        "label": "Username",
        "type": "text",
        "default": "luna_user",
        "required": true,
        "help": "PostgreSQL username"
      },
      {
        "name": "password",
        "label": "Password",
        "type": "password",
        "default": "",
        "required": true,
        "help": "PostgreSQL password (will be stored in external_services/postgres/config.json)"
      }
    ]
  },
  
  "commands": {
    "install": "docker pull postgres:16-alpine || docker pull postgres:16 || docker pull postgres:latest",
    "uninstall": "docker rm -f luna_postgres 2>/dev/null || true && docker volume rm luna_postgres_data 2>/dev/null || true",
    "start": "docker run -d --name luna_postgres --restart unless-stopped -p {{port}}:5432 -e POSTGRES_DB={{database}} -e POSTGRES_USER={{user}} -e POSTGRES_PASSWORD={{password}} -v luna_postgres_data:/var/lib/postgresql/data postgres:16",
    "stop": "docker stop luna_postgres 2>/dev/null || true",
    "restart": "docker restart luna_postgres",
    "health_check": "docker exec luna_postgres pg_isready -U {{user}} -d {{database}}",
    "enable_startup": "docker update --restart=always luna_postgres",
    "disable_startup": "docker update --restart=unless-stopped luna_postgres"
  },
  
  "health_check_expected": "accepting connections",
  "install_timeout": 120,
  
  "required_vars": [
    "DB_HOST",
    "DB_PORT", 
    "DB_NAME",
    "DB_USER",
    "DB_PASSWORD"
  ],
  "provides_vars": [
    "DATABASE_URL",
    "DB_HOST",
    "DB_PORT",
    "DB_NAME", 
    "DB_USER",
    "DB_PASSWORD"
  ],
  "post_install_env": {
    "DATABASE_URL": "postgresql://{{ user }}:{{ password }}@127.0.0.1:{{ port }}/{{ database }}",
    "DB_HOST": "127.0.0.1",
    "DB_PORT": "{{ port }}",
    "DB_NAME": "{{ database }}",
    "DB_USER": "{{ user }}",
    "DB_PASSWORD": "{{ password }}"
  }
}